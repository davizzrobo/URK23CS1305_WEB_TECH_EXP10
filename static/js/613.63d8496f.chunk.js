"use strict";(self.webpackChunkbudgetbuddy_client=self.webpackChunkbudgetbuddy_client||[]).push([[613],{6613:(e,s,n)=>{n.r(s),n.d(s,{default:()=>v});var a=n(5043),i=n(3216),t=n(3519),r=n(4282),l=n(6509),c=n(4196),d=n(4063),o=n(9566),h=n(3814),u=n(5016),x=n(9722),m=n(2145),j=n(579);const v=()=>{const{user:e}=(0,u.A)(),s=(0,i.Zp)(),[n,v]=(0,a.useState)([]),[g,p]=(0,a.useState)(!0),[y,A]=(0,a.useState)(!1),[N,b]=(0,a.useState)(null),[C,f]=(0,a.useState)(""),[k,L]=(0,a.useState)("name"),[E,S]=(0,a.useState)("asc"),[R,_]=(0,a.useState)("inactivityDays"),[D,T]=(0,a.useState)("desc");(0,a.useEffect)(()=>{if(e&&"admin"!==e.role)return m.oR.error("Access denied: Admin only"),void s("/dashboard");w()},[e,s]);const w=async()=>{try{p(!0);const e=localStorage.getItem("token"),s=await x.A.get("".concat({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.REACT_APP_API_URL||"http://localhost:5000/api","/admin/users"),{headers:{Authorization:"Bearer ".concat(e)}});v(s.data.data.users)}catch(e){console.error("Error fetching users:",e),m.oR.error("Failed to load users")}finally{p(!1)}},U=e=>{if(!e)return 0;const s=new Date,n=new Date(e),a=Math.abs(s-n);return Math.floor(a/864e5)},P=(e,s)=>{"admin"===s?k===e?S("asc"===E?"desc":"asc"):(L(e),S("asc")):R===e?T("asc"===D?"desc":"asc"):(_(e),T("asc"))},O=(e,s,n)=>[...e].sort((e,a)=>{let i,t;switch(s){case"name":i=e.name.toLowerCase(),t=a.name.toLowerCase();break;case"email":i=e.email.toLowerCase(),t=a.email.toLowerCase();break;case"joined":i=new Date(e.createdAt),t=new Date(a.createdAt);break;case"lastLogin":i=e.lastLogin?new Date(e.lastLogin):new Date(0),t=a.lastLogin?new Date(a.lastLogin):new Date(0);break;case"transactions":i=e.transactionCount||0,t=a.transactionCount||0;break;case"inactivityDays":i=U(e.lastActivity||e.lastLogin),t=U(a.lastActivity||a.lastLogin);break;case"status":i=e.adminRequestPending?1:0,t=a.adminRequestPending?1:0;break;default:return 0}return"asc"===n?i>t?1:i<t?-1:0:i<t?1:i>t?-1:0}),I=e=>{b(e),f(""),A(!0)},B=e=>e?new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"Never",F=(e,s)=>("admin"===s?k:R)!==e?" \u21c5":"asc"===("admin"===s?E:D)?" \u25b2":" \u25bc";if(g)return(0,j.jsx)("div",{className:"admin-users-page",children:(0,j.jsx)(t.A,{children:(0,j.jsxs)("div",{className:"loading-container",children:[(0,j.jsx)("div",{className:"spinner-border text-primary",role:"status",children:(0,j.jsx)("span",{className:"visually-hidden",children:"Loading..."})}),(0,j.jsx)("p",{children:"Loading users..."})]})})});const H=O(n.filter(e=>"admin"===e.role),k,E),M=O(n.filter(e=>"user"===e.role),R,D),V=M.filter(e=>U(e.lastActivity||e.lastLogin)>30);return(0,j.jsxs)("div",{className:"admin-users-page",children:[(0,j.jsxs)(t.A,{children:[(0,j.jsxs)("div",{className:"page-header",children:[(0,j.jsxs)("div",{children:[(0,j.jsx)("h1",{children:"\ud83d\udc65 User Management"}),(0,j.jsx)("p",{children:"View and manage all registered users"})]}),(0,j.jsx)(r.A,{variant:"outline-secondary",onClick:()=>s("/admin"),children:"\u2190 Back to Dashboard"})]}),(0,j.jsxs)("div",{className:"stats-cards",children:[(0,j.jsxs)("div",{className:"stat-card",children:[(0,j.jsx)("div",{className:"stat-icon",children:"\ud83d\udc65"}),(0,j.jsxs)("div",{className:"stat-info",children:[(0,j.jsx)("h3",{children:n.length}),(0,j.jsx)("p",{children:"Total Users"})]})]}),(0,j.jsxs)("div",{className:"stat-card",children:[(0,j.jsx)("div",{className:"stat-icon",children:"\ud83d\udc51"}),(0,j.jsxs)("div",{className:"stat-info",children:[(0,j.jsx)("h3",{children:H.length}),(0,j.jsx)("p",{children:"Admins"})]})]}),(0,j.jsxs)("div",{className:"stat-card",children:[(0,j.jsx)("div",{className:"stat-icon",children:"\ud83d\udc64"}),(0,j.jsxs)("div",{className:"stat-info",children:[(0,j.jsx)("h3",{children:M.length}),(0,j.jsx)("p",{children:"Regular Users"})]})]}),(0,j.jsxs)("div",{className:"stat-card",children:[(0,j.jsx)("div",{className:"stat-icon",children:"\u26a0\ufe0f"}),(0,j.jsxs)("div",{className:"stat-info",children:[(0,j.jsx)("h3",{children:V.length}),(0,j.jsx)("p",{children:"Inactive 30+ Days"})]})]})]}),(0,j.jsxs)("div",{className:"table-section",style:{marginBottom:"40px"},children:[(0,j.jsxs)("div",{className:"section-header",children:[(0,j.jsxs)("h2",{children:["\ud83d\udc51 Admin Users (",H.length,")"]}),(0,j.jsx)("p",{children:"Users with administrative privileges"})]}),0===H.length?(0,j.jsxs)(l.A,{variant:"info",className:"text-center",children:[(0,j.jsx)("h4",{children:"No Admin Users"}),(0,j.jsx)("p",{children:"There are no admin users in the system."})]}):(0,j.jsx)("div",{className:"users-table-container",children:(0,j.jsxs)(c.A,{responsive:!0,hover:!0,className:"users-table",children:[(0,j.jsx)("thead",{children:(0,j.jsxs)("tr",{children:[(0,j.jsxs)("th",{onClick:()=>P("name","admin"),style:{cursor:"pointer"},children:["User",F("name","admin")]}),(0,j.jsxs)("th",{onClick:()=>P("email","admin"),style:{cursor:"pointer"},children:["Email",F("email","admin")]}),(0,j.jsxs)("th",{onClick:()=>P("joined","admin"),style:{cursor:"pointer"},children:["Joined",F("joined","admin")]}),(0,j.jsxs)("th",{onClick:()=>P("lastLogin","admin"),style:{cursor:"pointer"},children:["Last Login",F("lastLogin","admin")]}),(0,j.jsxs)("th",{onClick:()=>P("transactions","admin"),style:{cursor:"pointer"},children:["Transactions",F("transactions","admin")]}),(0,j.jsx)("th",{children:"Actions"})]})}),(0,j.jsx)("tbody",{children:H.map(s=>(0,j.jsxs)("tr",{children:[(0,j.jsx)("td",{children:(0,j.jsxs)("div",{className:"user-cell",children:[(0,j.jsx)("img",{src:s.profilePic||"https://ui-avatars.com/api/?name=".concat(encodeURIComponent(s.name),"&background=random"),alt:s.name,className:"user-avatar"}),(0,j.jsxs)("div",{children:[(0,j.jsx)("strong",{children:s.name}),s._id===(null===e||void 0===e?void 0:e.id)&&(0,j.jsx)(d.A,{bg:"secondary",className:"ms-2",children:"You"})]})]})}),(0,j.jsx)("td",{children:s.email}),(0,j.jsx)("td",{children:B(s.createdAt)}),(0,j.jsx)("td",{children:B(s.lastLogin)}),(0,j.jsx)("td",{className:"text-center",children:(0,j.jsx)(d.A,{bg:"info",children:s.transactionCount||0})}),(0,j.jsx)("td",{children:s._id!==(null===e||void 0===e?void 0:e.id)?(0,j.jsx)(r.A,{variant:"outline-danger",size:"sm",onClick:()=>I(s),children:"\ud83d\uddd1\ufe0f Delete"}):(0,j.jsx)(r.A,{variant:"outline-secondary",size:"sm",disabled:!0,children:"Can't delete self"})})]},"admin-".concat(s._id)))})]})})]}),(0,j.jsxs)("div",{className:"table-section",children:[(0,j.jsxs)("div",{className:"section-header",children:[(0,j.jsxs)("h2",{children:["\ud83d\udc64 Regular Users (",M.length,")"]}),(0,j.jsx)("p",{children:"Standard user accounts"})]}),0===M.length?(0,j.jsxs)(l.A,{variant:"info",className:"text-center",children:[(0,j.jsx)("h4",{children:"No Regular Users"}),(0,j.jsx)("p",{children:"There are no regular users in the system."})]}):(0,j.jsx)("div",{className:"users-table-container",children:(0,j.jsxs)(c.A,{responsive:!0,hover:!0,className:"users-table",children:[(0,j.jsx)("thead",{children:(0,j.jsxs)("tr",{children:[(0,j.jsxs)("th",{onClick:()=>P("name","user"),style:{cursor:"pointer"},children:["User",F("name","user")]}),(0,j.jsxs)("th",{onClick:()=>P("email","user"),style:{cursor:"pointer"},children:["Email",F("email","user")]}),(0,j.jsxs)("th",{onClick:()=>P("status","user"),style:{cursor:"pointer"},children:["Status",F("status","user")]}),(0,j.jsxs)("th",{onClick:()=>P("inactivityDays","user"),style:{cursor:"pointer"},children:["Inactive Days",F("inactivityDays","user")]}),(0,j.jsxs)("th",{onClick:()=>P("joined","user"),style:{cursor:"pointer"},children:["Joined",F("joined","user")]}),(0,j.jsxs)("th",{onClick:()=>P("lastLogin","user"),style:{cursor:"pointer"},children:["Last Login",F("lastLogin","user")]}),(0,j.jsxs)("th",{onClick:()=>P("transactions","user"),style:{cursor:"pointer"},children:["Transactions",F("transactions","user")]}),(0,j.jsx)("th",{children:"Actions"})]})}),(0,j.jsx)("tbody",{children:M.map(e=>{const s=U(e.lastActivity||e.lastLogin),n=s>30;return(0,j.jsxs)("tr",{className:n?"inactive-user":"",children:[(0,j.jsx)("td",{children:(0,j.jsxs)("div",{className:"user-cell",children:[(0,j.jsx)("img",{src:e.profilePic||"https://ui-avatars.com/api/?name=".concat(encodeURIComponent(e.name),"&background=random"),alt:e.name,className:"user-avatar"}),(0,j.jsx)("div",{children:(0,j.jsx)("strong",{children:e.name})})]})}),(0,j.jsx)("td",{children:e.email}),(0,j.jsx)("td",{children:e.adminRequestPending?(0,j.jsx)(d.A,{bg:"warning",text:"dark",children:"\u23f3 Pending"}):n?(0,j.jsx)(d.A,{bg:"danger",children:"\u26a0\ufe0f Inactive"}):(0,j.jsx)(d.A,{bg:"success",children:"\u2713 Active"})}),(0,j.jsx)("td",{children:(0,j.jsxs)("span",{className:n?"text-danger fw-bold":"",children:[s," ",1===s?"day":"days",n&&" \u26a0\ufe0f"]})}),(0,j.jsx)("td",{children:B(e.createdAt)}),(0,j.jsx)("td",{children:B(e.lastLogin)}),(0,j.jsx)("td",{className:"text-center",children:(0,j.jsx)(d.A,{bg:"info",children:e.transactionCount||0})}),(0,j.jsx)("td",{children:(0,j.jsx)(r.A,{variant:n?"danger":"outline-danger",size:"sm",onClick:()=>I(e),children:"\ud83d\uddd1\ufe0f Delete"})})]},"user-".concat(e._id))})})]})})]}),V.length>0&&(0,j.jsxs)(l.A,{variant:"warning",className:"mt-4",children:[(0,j.jsx)("strong",{children:"\u26a0\ufe0f Notice:"})," ",V.length," user(s) have been inactive for more than 30 days and may be eligible for account deletion according to the Terms and Conditions."]})]}),(0,j.jsxs)(o.A,{show:y,onHide:()=>A(!1),centered:!0,children:[(0,j.jsx)(o.A.Header,{closeButton:!0,children:(0,j.jsx)(o.A.Title,{children:"\u26a0\ufe0f Delete User Account"})}),(0,j.jsxs)(o.A.Body,{children:[(0,j.jsxs)(l.A,{variant:"danger",children:[(0,j.jsx)("strong",{children:"Warning:"})," This action cannot be undone!"]}),(0,j.jsx)("p",{children:"You are about to permanently delete:"}),(0,j.jsxs)("div",{className:"user-to-delete-info",children:[(0,j.jsx)("strong",{children:"Name:"})," ",null===N||void 0===N?void 0:N.name,(0,j.jsx)("br",{}),(0,j.jsx)("strong",{children:"Email:"})," ",null===N||void 0===N?void 0:N.email,(0,j.jsx)("br",{}),(0,j.jsx)("strong",{children:"Role:"})," ",null===N||void 0===N?void 0:N.role,(0,j.jsx)("br",{}),(0,j.jsx)("strong",{children:"Transactions:"})," ",(null===N||void 0===N?void 0:N.transactionCount)||0,(0,j.jsx)("br",{}),(0,j.jsx)("strong",{children:"Inactive Days:"})," ",U((null===N||void 0===N?void 0:N.lastActivity)||(null===N||void 0===N?void 0:N.lastLogin))," days"]}),(0,j.jsx)("p",{className:"mt-3",children:"This will delete:"}),(0,j.jsxs)("ul",{children:[(0,j.jsx)("li",{children:"User account"}),(0,j.jsxs)("li",{children:["All ",(null===N||void 0===N?void 0:N.transactionCount)||0," transactions"]}),(0,j.jsx)("li",{children:"All associated data"})]}),(0,j.jsxs)("div",{className:"alert alert-info mt-3",children:[(0,j.jsx)("strong",{children:"\ud83d\udccb Ethical Notice:"})," User data will be permanently removed in compliance with data privacy policies and the inactivity terms accepted during registration."]}),(0,j.jsxs)(h.A.Group,{className:"mt-4",children:[(0,j.jsxs)(h.A.Label,{children:["Type ",(0,j.jsx)("strong",{children:"REMOVE"})," (in capitals) to confirm:"]}),(0,j.jsx)(h.A.Control,{type:"text",value:C,onChange:e=>f(e.target.value),placeholder:"Type REMOVE",autoFocus:!0})]})]}),(0,j.jsxs)(o.A.Footer,{children:[(0,j.jsx)(r.A,{variant:"secondary",onClick:()=>A(!1),children:"Cancel"}),(0,j.jsx)(r.A,{variant:"danger",onClick:async()=>{if("REMOVE"===C)try{const e=localStorage.getItem("token");await x.A.delete("".concat({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.REACT_APP_API_URL||"http://localhost:5000/api","/admin/users/").concat(N._id),{headers:{Authorization:"Bearer ".concat(e)}}),m.oR.success("User ".concat(N.name," deleted successfully")),A(!1),b(null),f(""),w()}catch(n){var e,s;console.error("Error deleting user:",n),m.oR.error((null===(e=n.response)||void 0===e||null===(s=e.data)||void 0===s?void 0:s.message)||"Failed to delete user")}else m.oR.error('Please type "REMOVE" to confirm')},disabled:"REMOVE"!==C,children:"Delete User"})]})]})]})}}}]);
//# sourceMappingURL=613.63d8496f.chunk.js.map