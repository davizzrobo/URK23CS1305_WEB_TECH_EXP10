"use strict";(self.webpackChunkbudgetbuddy_client=self.webpackChunkbudgetbuddy_client||[]).push([[630],{2630:(e,t,s)=>{s.r(t),s.d(t,{default:()=>A});var a=s(5043),r=s(3519),n=s(4282),i=s(8258),l=s(1072),c=s(8602),o=s(3814),d=s(5016),h=s(3216),g=s(7304),m=s(6058),x=s(9722),u=s(2145),b=s(1389),j=s(5239),p=s.n(j),v=s(579);g.t1.register(g.PP,g.kc,g.FN,g.No,g.E8,g.Bs,g.hE,g.m_,g.s$);const A=()=>{const{user:e}=(0,d.A)(),t=(0,h.Zp)(),[s,g]=(0,a.useState)(!0),[j,A]=(0,a.useState)({totalUsers:0,activeUsers:0,inactiveUsers:0,newUsersThisMonth:0,pendingAdminRequests:0,registrationData:[],loginData:[],activityData:[]}),[y,f]=(0,a.useState)("month"),[N,w]=(0,a.useState)((new Date).getMonth()),[D,C]=(0,a.useState)((new Date).getFullYear()),[S,U]=(0,a.useState)(document.body.classList.contains("dark-theme"));(0,a.useEffect)(()=>{const e=new MutationObserver(()=>{U(document.body.classList.contains("dark-theme"))});return e.observe(document.body,{attributes:!0,attributeFilter:["class"]}),()=>e.disconnect()},[]);const F=S?"#ffffff":"#000000",T=S?"#475569":"#e1e8ed";(0,a.useEffect)(()=>{e&&"admin"!==e.role&&(u.oR.error("Access denied. Admin only."),t("/dashboard"))},[e,t]),(0,a.useEffect)(()=>{R()},[y,N,D]);const R=async()=>{try{g(!0);const e=localStorage.getItem("token"),t=(await x.A.get("".concat("https://budget-buddy-h1k2.onrender.com/api","/admin/users"),{headers:{Authorization:"Bearer ".concat(e)}})).data.data.users,s=new Date,a=new Date(D,N,1),r=new Date(D,N+1,0);let n=t;"month"===y&&(n=t.filter(e=>{const t=new Date(e.createdAt);return t>=a&&t<=r}));const i=new Date(s.getTime()-2592e6),l=t.filter(e=>(e.lastLogin?new Date(e.lastLogin):new Date(e.createdAt))>=i),c=k(t,y,N,D),o=M(t,y),d=z(t),h=t.filter(e=>!0===e.adminRequestPending).length;A({totalUsers:t.length,activeUsers:l.length,inactiveUsers:t.length-l.length,newUsersThisMonth:n.length,pendingAdminRequests:h,registrationData:c,loginData:o,activityData:d})}catch(e){console.error("Error fetching stats:",e),u.oR.error("Failed to load statistics")}finally{g(!1)}},k=(e,t,s,a)=>{const r={};if("month"===t){const t=new Date(a,s+1,0).getDate();for(let e=1;e<=t;e++)r[e]=0;return e.forEach(e=>{const t=new Date(e.createdAt);if(t.getMonth()===s&&t.getFullYear()===a){const e=t.getDate();r[e]=(r[e]||0)+1}}),{labels:Object.keys(r).map(e=>"Day ".concat(e)),datasets:[{label:"New Registrations",data:Object.values(r),borderColor:"rgb(147, 51, 234)",backgroundColor:"rgba(147, 51, 234, 0.5)",tension:.4}]}}if("year"===t){const t=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];return t.forEach((e,t)=>r[t]=0),e.forEach(e=>{const t=new Date(e.createdAt);if(t.getFullYear()===a){const e=t.getMonth();r[e]=(r[e]||0)+1}}),{labels:t,datasets:[{label:"New Registrations",data:Object.values(r),borderColor:"rgb(147, 51, 234)",backgroundColor:"rgba(147, 51, 234, 0.5)",tension:.4}]}}return e.forEach(e=>{const t=new Date(e.createdAt),s="".concat(t.getFullYear(),"-").concat(String(t.getMonth()+1).padStart(2,"0"));r[s]=(r[s]||0)+1}),{labels:Object.keys(r).sort(),datasets:[{label:"New Registrations",data:Object.values(r),borderColor:"rgb(147, 51, 234)",backgroundColor:"rgba(147, 51, 234, 0.5)",tension:.4}]}},M=e=>{const t={Daily:0,Weekly:0,Monthly:0,Rarely:0},s=new Date;return e.forEach(e=>{const a=e.lastLogin?new Date(e.lastLogin):new Date(e.createdAt),r=(s-a)/864e5;r<1?t.Daily++:r<7?t.Weekly++:r<30?t.Monthly++:t.Rarely++}),{labels:Object.keys(t),datasets:[{label:"User Activity",data:Object.values(t),backgroundColor:["rgba(147, 51, 234, 0.8)","rgba(168, 85, 247, 0.8)","rgba(192, 132, 252, 0.8)","rgba(216, 180, 254, 0.8)"],borderColor:["rgb(147, 51, 234)","rgb(168, 85, 247)","rgb(192, 132, 252)","rgb(216, 180, 254)"],borderWidth:2}]}},z=e=>{const t=new Date,s=new Date(t.getTime()-2592e6),a=e.filter(e=>(e.lastLogin?new Date(e.lastLogin):new Date(e.createdAt))>=s).length;return{labels:["Active (30 days)","Inactive"],datasets:[{data:[a,e.length-a],backgroundColor:["rgba(34, 197, 94, 0.8)","rgba(239, 68, 68, 0.8)"],borderColor:["rgb(34, 197, 94)","rgb(239, 68, 68)"],borderWidth:2}]}},B=async()=>{try{u.oR.info("Generating PDF report with charts..."),await new Promise(e=>setTimeout(e,500));const t=new b.Ay("p","mm","a4"),s=t.internal.pageSize.getWidth(),a=t.internal.pageSize.getHeight();let r=20;t.setFontSize(24),t.setTextColor(147,51,234),t.text("BudgetBuddy Analytics Report",s/2,r,{align:"center"}),r+=10,t.setFontSize(10),t.setTextColor(100,100,100);const n=(new Date).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"});t.text("Generated on: ".concat(n),s/2,r,{align:"center"}),r+=15,t.setFontSize(16),t.setTextColor(0,0,0),t.text("Key Metrics",20,r),r+=10;const i=[{label:"Total Users",value:j.totalUsers},{label:"Active Users",value:j.activeUsers},{label:"New This Month",value:j.newUsersThisMonth}];t.setFontSize(10);let l=25;i.forEach((e,s)=>{t.setDrawColor(147,51,234),t.setLineWidth(1),t.rect(l,r,50,25),t.setFontSize(20),t.setTextColor(147,51,234),t.text(e.value.toString(),l+25,r+12,{align:"center"}),t.setFontSize(9),t.setTextColor(100,100,100),t.text(e.label,l+25,r+20,{align:"center"}),l+=55}),r+=35,t.setFontSize(16),t.setTextColor(0,0,0),t.text("User Growth Summary",20,r),r+=8,t.setFontSize(10),t.setTextColor(60,60,60);const c=(j.activeUsers/j.totalUsers*100).toFixed(1);t.text("Active users represent ".concat(c,"% of total user base."),20,r),r+=6,t.text("Company shows ".concat(j.newUsersThisMonth>0?"positive":"stable"," growth trend."),20,r),r+=15;const o=document.getElementById("registration-chart");if(o)try{const e=await p()(o,{scale:2,backgroundColor:"#ffffff",logging:!1,useCORS:!0}),n=e.toDataURL("image/png");t.setFontSize(14),t.setTextColor(0,0,0),t.text("User Registration Trend",20,r),r+=5;const i=s-40,l=Math.min(e.height*i/e.width,80);r+l>a-20&&(t.addPage(),r=20),t.addImage(n,"PNG",20,r,i,l),r+=l+10}catch(e){console.error("Error capturing registration chart:",e),t.setFontSize(10),t.setTextColor(200,0,0),t.text("Chart could not be rendered",20,r),r+=10}r>a-80&&(t.addPage(),r=20);const d=document.getElementById("activity-chart");if(d)try{const e=await p()(d,{scale:2,backgroundColor:"#ffffff",logging:!1,useCORS:!0}),n=e.toDataURL("image/png");t.setFontSize(14),t.setTextColor(0,0,0),t.text("Login Frequency Distribution",20,r),r+=5;const i=s-40,l=Math.min(e.height*i/e.width,80);r+l>a-20&&(t.addPage(),r=20),t.addImage(n,"PNG",20,r,i,l),r+=l+10}catch(e){console.error("Error capturing activity chart:",e),t.setFontSize(10),t.setTextColor(200,0,0),t.text("Chart could not be rendered",20,r),r+=10}const h=document.getElementById("pie-chart");if(h)try{const e=await p()(h,{scale:2,backgroundColor:"#ffffff",logging:!1,useCORS:!0}),n=e.toDataURL("image/png");r>a-100&&(t.addPage(),r=20),t.setFontSize(14),t.setTextColor(0,0,0),t.text("User Activity Status",20,r),r+=5;const i=(s-40)/1.5,l=Math.min(e.height*i/e.width,80);t.addImage(n,"PNG",s/2-i/2,r,i,l),r+=l+10}catch(e){console.error("Error capturing pie chart:",e),t.setFontSize(10),t.setTextColor(200,0,0),t.text("Chart could not be rendered",20,r),r+=10}t.setFontSize(8),t.setTextColor(150,150,150);const g=a-10;t.text("This report is generated by BudgetBuddy Admin Dashboard",s/2,g,{align:"center"}),t.text("\xa9 ".concat((new Date).getFullYear()," BudgetBuddy. All rights reserved."),s/2,g+4,{align:"center"}),t.save("BudgetBuddy-Analytics-".concat((new Date).toISOString().split("T")[0],".pdf")),u.oR.success("PDF report generated successfully!")}catch(e){console.error("Error generating PDF:",e),u.oR.error("Failed to generate PDF report")}},E={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"top",labels:{color:F,font:{size:12,weight:"500"}}},title:{display:!1}},scales:{x:{ticks:{color:F,font:{size:11}},grid:{color:T,display:!0}},y:{beginAtZero:!0,ticks:{stepSize:1,color:F,font:{size:11}},grid:{color:T,display:!0}}}},L={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"bottom",labels:{color:F,font:{size:12,weight:"500"},padding:15}},tooltip:{backgroundColor:S?"#16213e":"#ffffff",titleColor:F,bodyColor:F,borderColor:T,borderWidth:1}}};return s?(0,v.jsx)(r.A,{className:"admin-dashboard mt-5",children:(0,v.jsxs)("div",{className:"text-center",children:[(0,v.jsx)("div",{className:"spinner-border text-purple",role:"status",children:(0,v.jsx)("span",{className:"visually-hidden",children:"Loading..."})}),(0,v.jsx)("p",{className:"mt-3",children:"Loading analytics..."})]})}):(0,v.jsxs)(r.A,{className:"admin-dashboard",fluid:!0,children:[(0,v.jsxs)("div",{className:"dashboard-header",children:[(0,v.jsxs)("div",{children:[(0,v.jsx)("h1",{children:"\ud83d\udcca Admin Analytics Dashboard"}),(0,v.jsx)("p",{className:"text-muted",children:"Company Growth & User Insights"})]}),(0,v.jsx)(n.A,{variant:"primary",onClick:B,className:"print-btn",children:"\ud83d\udda8\ufe0f Generate Report"})]}),(0,v.jsx)(i.A,{className:"mb-4 time-selector-card",children:(0,v.jsx)(i.A.Body,{children:(0,v.jsxs)(l.A,{className:"align-items-center",children:[(0,v.jsx)(c.A,{md:6,children:(0,v.jsxs)(o.A.Group,{children:[(0,v.jsx)(o.A.Label,{children:"Time Range"}),(0,v.jsxs)(o.A.Select,{value:y,onChange:e=>f(e.target.value),className:"form-control",children:[(0,v.jsx)("option",{value:"month",children:"This Month"}),(0,v.jsx)("option",{value:"year",children:"This Year"}),(0,v.jsx)("option",{value:"all",children:"All Time"})]})]})}),"month"===y&&(0,v.jsx)(c.A,{md:6,children:(0,v.jsxs)(o.A.Group,{children:[(0,v.jsx)(o.A.Label,{children:"Select Month"}),(0,v.jsxs)(l.A,{children:[(0,v.jsx)(c.A,{children:(0,v.jsx)(o.A.Select,{value:N,onChange:e=>w(parseInt(e.target.value)),children:["January","February","March","April","May","June","July","August","September","October","November","December"].map((e,t)=>(0,v.jsx)("option",{value:t,children:e},t))})}),(0,v.jsx)(c.A,{children:(0,v.jsx)(o.A.Select,{value:D,onChange:e=>C(parseInt(e.target.value)),children:[2023,2024,2025,2026].map(e=>(0,v.jsx)("option",{value:e,children:e},e))})})]})]})})]})})}),(0,v.jsxs)(l.A,{className:"mb-4",children:[(0,v.jsx)(c.A,{md:3,sm:6,className:"mb-3",children:(0,v.jsx)(i.A,{className:"stat-card stat-card-purple",children:(0,v.jsxs)(i.A.Body,{children:[(0,v.jsx)("div",{className:"stat-icon",children:"\ud83d\udc65"}),(0,v.jsx)("div",{className:"stat-number",children:j.totalUsers}),(0,v.jsx)("div",{className:"stat-label",children:"Total Users"})]})})}),(0,v.jsx)(c.A,{md:3,sm:6,className:"mb-3",children:(0,v.jsx)(i.A,{className:"stat-card stat-card-green",children:(0,v.jsxs)(i.A.Body,{children:[(0,v.jsx)("div",{className:"stat-icon",children:"\u2705"}),(0,v.jsx)("div",{className:"stat-number",children:j.activeUsers}),(0,v.jsx)("div",{className:"stat-label",children:"Active Users"}),(0,v.jsx)("small",{className:"text-muted",children:"Last 30 days"})]})})}),(0,v.jsx)(c.A,{md:3,sm:6,className:"mb-3",children:(0,v.jsx)(i.A,{className:"stat-card stat-card-blue",children:(0,v.jsxs)(i.A.Body,{children:[(0,v.jsx)("div",{className:"stat-icon",children:"\ud83d\udcc8"}),(0,v.jsx)("div",{className:"stat-number",children:j.newUsersThisMonth}),(0,v.jsx)("div",{className:"stat-label",children:"New Registrations"}),(0,v.jsx)("small",{className:"text-muted",children:"Selected period"})]})})}),(0,v.jsx)(c.A,{md:3,sm:6,className:"mb-3",children:(0,v.jsx)(i.A,{className:"stat-card stat-card-orange",children:(0,v.jsxs)(i.A.Body,{children:[(0,v.jsx)("div",{className:"stat-icon",children:"\ud83d\udca4"}),(0,v.jsx)("div",{className:"stat-number",children:j.inactiveUsers}),(0,v.jsx)("div",{className:"stat-label",children:"Inactive Users"}),(0,v.jsx)("small",{className:"text-muted",children:"30+ days"})]})})})]}),(0,v.jsxs)(l.A,{className:"mb-4",children:[(0,v.jsx)(c.A,{lg:8,className:"mb-3",children:(0,v.jsxs)(i.A,{className:"chart-card",id:"registration-chart",children:[(0,v.jsxs)(i.A.Header,{children:[(0,v.jsx)("h5",{children:"\ud83d\udcca User Registration Trend"}),(0,v.jsx)("p",{className:"mb-0 text-muted",children:"New user signups over time"})]}),(0,v.jsx)(i.A.Body,{children:(0,v.jsx)("div",{style:{height:"300px"},children:(0,v.jsx)(m.N1,{data:j.registrationData,options:E})})})]})}),(0,v.jsx)(c.A,{lg:4,className:"mb-3",children:(0,v.jsxs)(i.A,{className:"chart-card",id:"pie-chart",children:[(0,v.jsxs)(i.A.Header,{children:[(0,v.jsx)("h5",{children:"\ud83d\udc41\ufe0f User Activity Status"}),(0,v.jsx)("p",{className:"mb-0 text-muted",children:"Active vs Inactive"})]}),(0,v.jsx)(i.A.Body,{children:(0,v.jsx)("div",{style:{height:"300px"},children:(0,v.jsx)(m.Fq,{data:j.activityData,options:L})})})]})})]}),(0,v.jsxs)(l.A,{className:"mb-4",children:[(0,v.jsx)(c.A,{lg:6,className:"mb-3",children:(0,v.jsxs)(i.A,{className:"chart-card",id:"activity-chart",children:[(0,v.jsxs)(i.A.Header,{children:[(0,v.jsx)("h5",{children:"\ud83d\udd04 Login Frequency Distribution"}),(0,v.jsx)("p",{className:"mb-0 text-muted",children:"How often users visit"})]}),(0,v.jsx)(i.A.Body,{children:(0,v.jsx)("div",{style:{height:"300px"},children:(0,v.jsx)(m.yP,{data:j.loginData,options:E})})})]})}),(0,v.jsx)(c.A,{lg:6,className:"mb-3",children:(0,v.jsxs)(i.A,{className:"chart-card insight-card",children:[(0,v.jsx)(i.A.Header,{children:(0,v.jsx)("h5",{children:"\ud83d\udca1 Key Insights"})}),(0,v.jsxs)(i.A.Body,{children:[(0,v.jsxs)("div",{className:"insight-item",children:[(0,v.jsx)("div",{className:"insight-icon",children:"\ud83d\udcc8"}),(0,v.jsxs)("div",{children:[(0,v.jsx)("h6",{children:"User Engagement"}),(0,v.jsxs)("p",{children:[(j.activeUsers/j.totalUsers*100).toFixed(1),"% of users are actively using the platform"]})]})]}),(0,v.jsxs)("div",{className:"insight-item",children:[(0,v.jsx)("div",{className:"insight-icon",children:"\ud83c\udfaf"}),(0,v.jsxs)("div",{children:[(0,v.jsx)("h6",{children:"Growth Rate"}),(0,v.jsxs)("p",{children:[j.newUsersThisMonth," new registrations in selected period"]})]})]}),(0,v.jsxs)("div",{className:"insight-item",children:[(0,v.jsx)("div",{className:"insight-icon",children:"\u2b50"}),(0,v.jsxs)("div",{children:[(0,v.jsx)("h6",{children:"Platform Health"}),(0,v.jsx)("p",{children:j.inactiveUsers<j.activeUsers?"Strong user retention and engagement":"Consider user re-engagement campaigns"})]})]}),(0,v.jsxs)("div",{className:"insight-item",children:[(0,v.jsx)("div",{className:"insight-icon",children:"\ud83d\ude80"}),(0,v.jsxs)("div",{children:[(0,v.jsx)("h6",{children:"Recommendation"}),(0,v.jsx)("p",{children:j.newUsersThisMonth>10?"Excellent growth! Maintain current strategies.":"Focus on user acquisition and marketing."})]})]})]})]})})]}),(0,v.jsx)(l.A,{children:(0,v.jsx)(c.A,{children:(0,v.jsx)(i.A,{className:"action-card",children:(0,v.jsxs)(i.A.Body,{children:[(0,v.jsx)("h5",{children:"\u26a1 Quick Actions"}),(0,v.jsxs)("div",{className:"action-buttons",children:[(0,v.jsxs)(n.A,{variant:"outline-warning",onClick:()=>t("/admin/requests"),className:"position-relative",children:["\ud83d\udc51 Admin Requests",j.pendingAdminRequests>0&&(0,v.jsx)("span",{className:"position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger",children:j.pendingAdminRequests})]}),(0,v.jsx)(n.A,{variant:"outline-primary",onClick:()=>t("/admin/users"),children:"\ud83d\udc65 Manage Users"}),(0,v.jsx)(n.A,{variant:"outline-success",onClick:B,children:"\ud83d\udcc4 Export Report"}),(0,v.jsx)(n.A,{variant:"outline-info",onClick:R,children:"\ud83d\udd04 Refresh Data"})]})]})})})})]})}}}]);
//# sourceMappingURL=630.31ef4736.chunk.js.map