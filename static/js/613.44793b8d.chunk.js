"use strict";(self.webpackChunkbudgetbuddy_client=self.webpackChunkbudgetbuddy_client||[]).push([[613],{6613:(e,s,n)=>{n.r(s),n.d(s,{default:()=>v});var a=n(5043),i=n(3216),t=n(3519),r=n(4282),c=n(6509),l=n(4196),d=n(4063),o=n(9566),h=n(3814),u=n(5016),m=n(9722),x=n(2145),j=n(579);const v=()=>{const{user:e}=(0,u.A)(),s=(0,i.Zp)(),[n,v]=(0,a.useState)([]),[g,p]=(0,a.useState)(!0),[y,A]=(0,a.useState)(!1),[b,N]=(0,a.useState)(null),[k,C]=(0,a.useState)(""),[f,L]=(0,a.useState)("name"),[w,D]=(0,a.useState)("asc"),[R,U]=(0,a.useState)("inactivityDays"),[E,S]=(0,a.useState)("desc");(0,a.useEffect)(()=>{if(e&&"admin"!==e.role)return x.oR.error("Access denied: Admin only"),void s("/dashboard");T()},[e,s]);const T=async()=>{try{p(!0);const e=localStorage.getItem("token"),s=await m.A.get("".concat("https://budget-buddy-h1k2.onrender.com/api","/admin/users"),{headers:{Authorization:"Bearer ".concat(e)}});v(s.data.data.users)}catch(e){console.error("Error fetching users:",e),x.oR.error("Failed to load users")}finally{p(!1)}},I=e=>{if(!e)return 0;const s=new Date,n=new Date(e),a=Math.abs(s-n);return Math.floor(a/864e5)},M=(e,s)=>{"admin"===s?f===e?D("asc"===w?"desc":"asc"):(L(e),D("asc")):R===e?S("asc"===E?"desc":"asc"):(U(e),S("asc"))},P=(e,s,n)=>[...e].sort((e,a)=>{let i,t;switch(s){case"name":i=e.name.toLowerCase(),t=a.name.toLowerCase();break;case"email":i=e.email.toLowerCase(),t=a.email.toLowerCase();break;case"joined":i=new Date(e.createdAt),t=new Date(a.createdAt);break;case"lastLogin":i=e.lastLogin?new Date(e.lastLogin):new Date(0),t=a.lastLogin?new Date(a.lastLogin):new Date(0);break;case"transactions":i=e.transactionCount||0,t=a.transactionCount||0;break;case"inactivityDays":i=I(e.lastActivity||e.lastLogin),t=I(a.lastActivity||a.lastLogin);break;case"status":i=e.adminRequestPending?1:0,t=a.adminRequestPending?1:0;break;default:return 0}return"asc"===n?i>t?1:i<t?-1:0:i<t?1:i>t?-1:0}),_=e=>{N(e),C(""),A(!0)},B=e=>e?new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"Never",V=(e,s)=>("admin"===s?f:R)!==e?" \u21c5":"asc"===("admin"===s?w:E)?" \u25b2":" \u25bc";if(g)return(0,j.jsx)("div",{className:"admin-users-page",children:(0,j.jsx)(t.A,{children:(0,j.jsxs)("div",{className:"loading-container",children:[(0,j.jsx)("div",{className:"spinner-border text-primary",role:"status",children:(0,j.jsx)("span",{className:"visually-hidden",children:"Loading..."})}),(0,j.jsx)("p",{children:"Loading users..."})]})})});const z=P(n.filter(e=>"admin"===e.role),f,w),O=P(n.filter(e=>"user"===e.role),R,E),F=O.filter(e=>I(e.lastActivity||e.lastLogin)>30);return(0,j.jsxs)("div",{className:"admin-users-page",children:[(0,j.jsxs)(t.A,{children:[(0,j.jsxs)("div",{className:"page-header",children:[(0,j.jsxs)("div",{children:[(0,j.jsx)("h1",{children:"\ud83d\udc65 User Management"}),(0,j.jsx)("p",{children:"View and manage all registered users"})]}),(0,j.jsx)(r.A,{variant:"outline-secondary",onClick:()=>s("/admin"),children:"\u2190 Back to Dashboard"})]}),(0,j.jsxs)("div",{className:"stats-cards",children:[(0,j.jsxs)("div",{className:"stat-card",children:[(0,j.jsx)("div",{className:"stat-icon",children:"\ud83d\udc65"}),(0,j.jsxs)("div",{className:"stat-info",children:[(0,j.jsx)("h3",{children:n.length}),(0,j.jsx)("p",{children:"Total Users"})]})]}),(0,j.jsxs)("div",{className:"stat-card",children:[(0,j.jsx)("div",{className:"stat-icon",children:"\ud83d\udc51"}),(0,j.jsxs)("div",{className:"stat-info",children:[(0,j.jsx)("h3",{children:z.length}),(0,j.jsx)("p",{children:"Admins"})]})]}),(0,j.jsxs)("div",{className:"stat-card",children:[(0,j.jsx)("div",{className:"stat-icon",children:"\ud83d\udc64"}),(0,j.jsxs)("div",{className:"stat-info",children:[(0,j.jsx)("h3",{children:O.length}),(0,j.jsx)("p",{children:"Regular Users"})]})]}),(0,j.jsxs)("div",{className:"stat-card",children:[(0,j.jsx)("div",{className:"stat-icon",children:"\u26a0\ufe0f"}),(0,j.jsxs)("div",{className:"stat-info",children:[(0,j.jsx)("h3",{children:F.length}),(0,j.jsx)("p",{children:"Inactive 30+ Days"})]})]})]}),(0,j.jsxs)("div",{className:"table-section",style:{marginBottom:"40px"},children:[(0,j.jsxs)("div",{className:"section-header",children:[(0,j.jsxs)("h2",{children:["\ud83d\udc51 Admin Users (",z.length,")"]}),(0,j.jsx)("p",{children:"Users with administrative privileges"})]}),0===z.length?(0,j.jsxs)(c.A,{variant:"info",className:"text-center",children:[(0,j.jsx)("h4",{children:"No Admin Users"}),(0,j.jsx)("p",{children:"There are no admin users in the system."})]}):(0,j.jsx)("div",{className:"users-table-container",children:(0,j.jsxs)(l.A,{responsive:!0,hover:!0,className:"users-table",children:[(0,j.jsx)("thead",{children:(0,j.jsxs)("tr",{children:[(0,j.jsxs)("th",{onClick:()=>M("name","admin"),style:{cursor:"pointer"},children:["User",V("name","admin")]}),(0,j.jsxs)("th",{onClick:()=>M("email","admin"),style:{cursor:"pointer"},children:["Email",V("email","admin")]}),(0,j.jsxs)("th",{onClick:()=>M("joined","admin"),style:{cursor:"pointer"},children:["Joined",V("joined","admin")]}),(0,j.jsxs)("th",{onClick:()=>M("lastLogin","admin"),style:{cursor:"pointer"},children:["Last Login",V("lastLogin","admin")]}),(0,j.jsxs)("th",{onClick:()=>M("transactions","admin"),style:{cursor:"pointer"},children:["Transactions",V("transactions","admin")]}),(0,j.jsx)("th",{children:"Actions"})]})}),(0,j.jsx)("tbody",{children:z.map(s=>(0,j.jsxs)("tr",{children:[(0,j.jsx)("td",{children:(0,j.jsxs)("div",{className:"user-cell",children:[(0,j.jsx)("img",{src:s.profilePic||"https://ui-avatars.com/api/?name=".concat(encodeURIComponent(s.name),"&background=random"),alt:s.name,className:"user-avatar"}),(0,j.jsxs)("div",{children:[(0,j.jsx)("strong",{children:s.name}),s._id===(null===e||void 0===e?void 0:e.id)&&(0,j.jsx)(d.A,{bg:"secondary",className:"ms-2",children:"You"})]})]})}),(0,j.jsx)("td",{children:s.email}),(0,j.jsx)("td",{children:B(s.createdAt)}),(0,j.jsx)("td",{children:B(s.lastLogin)}),(0,j.jsx)("td",{className:"text-center",children:(0,j.jsx)(d.A,{bg:"info",children:s.transactionCount||0})}),(0,j.jsx)("td",{children:s._id!==(null===e||void 0===e?void 0:e.id)?(0,j.jsx)(r.A,{variant:"outline-danger",size:"sm",onClick:()=>_(s),children:"\ud83d\uddd1\ufe0f Delete"}):(0,j.jsx)(r.A,{variant:"outline-secondary",size:"sm",disabled:!0,children:"Can't delete self"})})]},"admin-".concat(s._id)))})]})})]}),(0,j.jsxs)("div",{className:"table-section",children:[(0,j.jsxs)("div",{className:"section-header",children:[(0,j.jsxs)("h2",{children:["\ud83d\udc64 Regular Users (",O.length,")"]}),(0,j.jsx)("p",{children:"Standard user accounts"})]}),0===O.length?(0,j.jsxs)(c.A,{variant:"info",className:"text-center",children:[(0,j.jsx)("h4",{children:"No Regular Users"}),(0,j.jsx)("p",{children:"There are no regular users in the system."})]}):(0,j.jsx)("div",{className:"users-table-container",children:(0,j.jsxs)(l.A,{responsive:!0,hover:!0,className:"users-table",children:[(0,j.jsx)("thead",{children:(0,j.jsxs)("tr",{children:[(0,j.jsxs)("th",{onClick:()=>M("name","user"),style:{cursor:"pointer"},children:["User",V("name","user")]}),(0,j.jsxs)("th",{onClick:()=>M("email","user"),style:{cursor:"pointer"},children:["Email",V("email","user")]}),(0,j.jsxs)("th",{onClick:()=>M("status","user"),style:{cursor:"pointer"},children:["Status",V("status","user")]}),(0,j.jsxs)("th",{onClick:()=>M("inactivityDays","user"),style:{cursor:"pointer"},children:["Inactive Days",V("inactivityDays","user")]}),(0,j.jsxs)("th",{onClick:()=>M("joined","user"),style:{cursor:"pointer"},children:["Joined",V("joined","user")]}),(0,j.jsxs)("th",{onClick:()=>M("lastLogin","user"),style:{cursor:"pointer"},children:["Last Login",V("lastLogin","user")]}),(0,j.jsxs)("th",{onClick:()=>M("transactions","user"),style:{cursor:"pointer"},children:["Transactions",V("transactions","user")]}),(0,j.jsx)("th",{children:"Actions"})]})}),(0,j.jsx)("tbody",{children:O.map(e=>{const s=I(e.lastActivity||e.lastLogin),n=s>30;return(0,j.jsxs)("tr",{className:n?"inactive-user":"",children:[(0,j.jsx)("td",{children:(0,j.jsxs)("div",{className:"user-cell",children:[(0,j.jsx)("img",{src:e.profilePic||"https://ui-avatars.com/api/?name=".concat(encodeURIComponent(e.name),"&background=random"),alt:e.name,className:"user-avatar"}),(0,j.jsx)("div",{children:(0,j.jsx)("strong",{children:e.name})})]})}),(0,j.jsx)("td",{children:e.email}),(0,j.jsx)("td",{children:e.adminRequestPending?(0,j.jsx)(d.A,{bg:"warning",text:"dark",children:"\u23f3 Pending"}):n?(0,j.jsx)(d.A,{bg:"danger",children:"\u26a0\ufe0f Inactive"}):(0,j.jsx)(d.A,{bg:"success",children:"\u2713 Active"})}),(0,j.jsx)("td",{children:(0,j.jsxs)("span",{className:n?"text-danger fw-bold":"",children:[s," ",1===s?"day":"days",n&&" \u26a0\ufe0f"]})}),(0,j.jsx)("td",{children:B(e.createdAt)}),(0,j.jsx)("td",{children:B(e.lastLogin)}),(0,j.jsx)("td",{className:"text-center",children:(0,j.jsx)(d.A,{bg:"info",children:e.transactionCount||0})}),(0,j.jsx)("td",{children:(0,j.jsx)(r.A,{variant:n?"danger":"outline-danger",size:"sm",onClick:()=>_(e),children:"\ud83d\uddd1\ufe0f Delete"})})]},"user-".concat(e._id))})})]})})]}),F.length>0&&(0,j.jsxs)(c.A,{variant:"warning",className:"mt-4",children:[(0,j.jsx)("strong",{children:"\u26a0\ufe0f Notice:"})," ",F.length," user(s) have been inactive for more than 30 days and may be eligible for account deletion according to the Terms and Conditions."]})]}),(0,j.jsxs)(o.A,{show:y,onHide:()=>A(!1),centered:!0,children:[(0,j.jsx)(o.A.Header,{closeButton:!0,children:(0,j.jsx)(o.A.Title,{children:"\u26a0\ufe0f Delete User Account"})}),(0,j.jsxs)(o.A.Body,{children:[(0,j.jsxs)(c.A,{variant:"danger",children:[(0,j.jsx)("strong",{children:"Warning:"})," This action cannot be undone!"]}),(0,j.jsx)("p",{children:"You are about to permanently delete:"}),(0,j.jsxs)("div",{className:"user-to-delete-info",children:[(0,j.jsx)("strong",{children:"Name:"})," ",null===b||void 0===b?void 0:b.name,(0,j.jsx)("br",{}),(0,j.jsx)("strong",{children:"Email:"})," ",null===b||void 0===b?void 0:b.email,(0,j.jsx)("br",{}),(0,j.jsx)("strong",{children:"Role:"})," ",null===b||void 0===b?void 0:b.role,(0,j.jsx)("br",{}),(0,j.jsx)("strong",{children:"Transactions:"})," ",(null===b||void 0===b?void 0:b.transactionCount)||0,(0,j.jsx)("br",{}),(0,j.jsx)("strong",{children:"Inactive Days:"})," ",I((null===b||void 0===b?void 0:b.lastActivity)||(null===b||void 0===b?void 0:b.lastLogin))," days"]}),(0,j.jsx)("p",{className:"mt-3",children:"This will delete:"}),(0,j.jsxs)("ul",{children:[(0,j.jsx)("li",{children:"User account"}),(0,j.jsxs)("li",{children:["All ",(null===b||void 0===b?void 0:b.transactionCount)||0," transactions"]}),(0,j.jsx)("li",{children:"All associated data"})]}),(0,j.jsxs)("div",{className:"alert alert-info mt-3",children:[(0,j.jsx)("strong",{children:"\ud83d\udccb Ethical Notice:"})," User data will be permanently removed in compliance with data privacy policies and the inactivity terms accepted during registration."]}),(0,j.jsxs)(h.A.Group,{className:"mt-4",children:[(0,j.jsxs)(h.A.Label,{children:["Type ",(0,j.jsx)("strong",{children:"REMOVE"})," (in capitals) to confirm:"]}),(0,j.jsx)(h.A.Control,{type:"text",value:k,onChange:e=>C(e.target.value),placeholder:"Type REMOVE",autoFocus:!0})]})]}),(0,j.jsxs)(o.A.Footer,{children:[(0,j.jsx)(r.A,{variant:"secondary",onClick:()=>A(!1),children:"Cancel"}),(0,j.jsx)(r.A,{variant:"danger",onClick:async()=>{if("REMOVE"===k)try{const e=localStorage.getItem("token");await m.A.delete("".concat("https://budget-buddy-h1k2.onrender.com/api","/admin/users/").concat(b._id),{headers:{Authorization:"Bearer ".concat(e)}}),x.oR.success("User ".concat(b.name," deleted successfully")),A(!1),N(null),C(""),T()}catch(n){var e,s;console.error("Error deleting user:",n),x.oR.error((null===(e=n.response)||void 0===e||null===(s=e.data)||void 0===s?void 0:s.message)||"Failed to delete user")}else x.oR.error('Please type "REMOVE" to confirm')},disabled:"REMOVE"!==k,children:"Delete User"})]})]})]})}}}]);
//# sourceMappingURL=613.44793b8d.chunk.js.map